# strategy

Syntax:

```pine

strategy(title, shorttitle, overlay, format, precision, scale, pyramiding, calc_on_order_fills, calc_on_every_tick, max_bars_back, backtest_fill_limits_assumption, default_qty_type, default_qty_value, initial_capital, currency, slippage, commission_type, commission_value, process_orders_on_close, close_entries_rule, margin_long, margin_short, explicit_plot_zorder, max_lines_count, max_labels_count, max_boxes_count, calc_bars_count, risk_free_rate, use_bar_magnifier, fill_orders_on_standard_ohlc, max_polylines_count, dynamic_requests, behind_chart) → void

```

---

## title (const string)

عنوان اسکریپت. این عنوان در نمودار نمایش داده می‌شود، اگر از آرگومان `shorttitle` استفاده نشود. همچنین، در زمان انتشار اسکریپت، به‌عنوان اسم پیش‌فرض برای انتشار استفاده می‌شود.

---

## shorttitle (const string)
 
نام نمایشی اسکریپت در نمودارها. اگر مشخص شود، در بیشتر پنجره‌های مرتبط با نمودار، جایگزین آرگومان title خواهد شد. این آرگومان اختیاری است و به‌طور پیش‌فرض مقدار آرگومان title را می‌گیرد.

---

- [x] ## default_qty_type (const string)

واحدهایی که برای default_qty_value استفاده می‌شوند را مشخص می‌کند. مقادیر ممکن عبارتند از:

- `strategy.fixed`: برای تعداد قراردادها، سهام یا لات‌ها (مقدار ثابت).
- `strategy.cash`: برای مقادیر ارزی (مقدار نقدی).
- `strategy.percent_of_equity`: برای درصدی از موجودی سرمایه (`equity`).

این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `strategy.fixed` است.

---

- [x] default_qty_value (const int/float)

مقدار پیش‌فرض برای معامله، بر اساس واحدهایی که با پارامتر `default_qty_type` تعیین شده است، مشخص می‌شود.

این تنظیم می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `1` است.

---

- [x] initial_capital (const int/float)

مقدار اولیه سرمایه موجود برای استراتژی جهت انجام معامله، بر حسب واحد ارز مشخص می‌شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `1000000` (یک میلیون واحد ارز) است.

---


- [x] pyramiding (const int)


حداکثر تعداد ورودی‌های مجاز در یک جهت مشخص را تعیین می‌کند.

- اگر مقدار برابر `0` باشد، فقط یک سفارش ورودی در همان جهت قابل باز شدن است و سفارش‌های اضافی رد خواهند شد.
- این تنظیم می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی نیز تغییر کند.

این آرگومان اختیاری است و مقدار پیش‌فرض آن 0 است.

مثلاً: اگر pyramiding = 3 باشد، استراتژی می‌تواند حداکثر سه معامله باز داشته باشد و قبل از بسته شدن یکی از این معاملات، سفارش جدیدی نمی‌تواند باز شود.

---

## format (const string)

فرمت نمایش مقادیر اسکریپت را مشخص می‌کند. مقادیر ممکن:

- `format.inherit:` فرمت را از تنظیمات پیش‌فرض ابزار یا داده‌ها به ارث می‌برد.
- `format.price:` مقادیر را به‌صورت قیمت نمایش می‌دهد.
- `format.volume:` مقادیر را به‌صورت حجم نمایش می‌دهد.
- `format.percent:` مقادیر را به‌صورت درصد نمایش می‌دهد.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `format.inherit` است.

---

## precision (const int)

تعداد ارقام اعشار نمایش داده‌شده برای مقادیر اسکریپت را مشخص می‌کند. این مقدار باید یک عدد صحیح غیرمنفی باشد که از 16 بیشتر نباشد.

- اگر فرمت روی `format.inherit` تنظیم شده باشد و مقدار `precision` مشخص شود، فرمت به‌طور خودکار به `format.price `تغییر می‌کند.
- اگر فرمت روی `format.volume` باشد، مقدار `precision` تأثیری نخواهد داشت، زیرا قوانین اعشار تعریف‌شده توسط `format.volume` اولویت دارند.

این آرگومان اختیاری است و مقدار پیش‌فرض آن از دقت نماد (`Symbol`) در نمودار به ارث برده می‌شود.

---

## scale (const scale_type)

مقیاس قیمتی که استفاده می‌شود. مقادیر ممکن:

- `scale.right`: مقادیر اسکریپت روی مقیاس قیمتی سمت راست نمودار نمایش داده می‌شوند.
- `scale.left`: مقادیر اسکریپت روی مقیاس قیمتی سمت چپ نمودار نمایش داده می‌شوند.
- `scale.none`: مقادیر اسکریپت مقیاسی ندارند و فقط زمانی قابل استفاده است که overlay = true تنظیم شده باشد.

این آرگومان اختیاری است و به‌طور پیش‌فرض اسکریپت از همان مقیاس نمودار استفاده می‌کند.

---


## calc_on_order_fills (const bool)

مشخص می‌کند که آیا استراتژی باید پس از اجرای یک سفارش مجدداً محاسبه شود یا خیر.

- اگر مقدار `true` باشد، استراتژی بلافاصله پس از اجرای یک سفارش محاسبه مجدد انجام می‌دهد، به جای اینکه فقط در زمان بسته شدن کندل این کار را انجام دهد.
- این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `false` است.

---

## calc_on_every_tick (const bool)

مشخص می‌کند که آیا استراتژی باید در هر تغییر لحظه‌ای (Realtime Tick) محاسبه شود یا خیر.

- اگر مقدار `true` باشد، زمانی که استراتژی در یک کندل لحظه‌ای (Realtime Bar) اجرا می‌شود، در هر به‌روزرسانی نمودار محاسبه مجدد انجام می‌دهد.
- اگر مقدار `false` باشد، استراتژی فقط زمانی محاسبه می‌شود که کندل لحظه‌ای بسته شود.
- این آرگومان روی محاسبات داده‌های تاریخی تأثیری ندارد.
- این تنظیم را می‌توان از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داد.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `false` است.

---

## max_bars_back (const int)

طول بافر تاریخی که اسکریپت برای هر متغیر و تابع نگه می‌دارد را مشخص می‌کند. این مقدار تعیین می‌کند که چند مقدار گذشته می‌توانند با استفاده از عملگر [] (برای ارجاع به تاریخچه) دسترسی داشته باشند.

- اندازه بافر موردنیاز به‌طور خودکار توسط محیط اجرایی پاین اسکریپت شناسایی می‌شود.
- استفاده از این پارامتر فقط در صورتی ضروری است که به دلیل عدم شناسایی خودکار، خطای زمان اجرا (Runtime Error) رخ دهد.
- برای اطلاعات بیشتر درباره مکانیزم‌های بافر تاریخی، می‌توانید به مرکز راهنمایی پاین اسکریپت مراجعه کنید.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `0` است.

---

## backtest_fill_limits_assumption (const int)

آستانه اجرای سفارش محدود (`Limit Order`) را بر حسب تعداد تیک‌ها مشخص می‌کند.

- وقتی از این پارامتر استفاده شود، سفارش‌های محدود تنها در صورتی اجرا می‌شوند که قیمت بازار از سطح محدود سفارش به‌اندازه تعداد تیک مشخص‌شده فراتر برود.
- این تنظیم برای کنترل دقت و شرایط اجرای سفارش‌های محدود به‌کار می‌رود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `0` است.

---



## currency (const string)

ارز مورد استفاده توسط استراتژی در محاسبات مرتبط با ارز را مشخص می‌کند.

- موقعیت‌های بازار همچنان با تبدیل ارز به ارز نماد نمودار باز می‌شوند.
- نرخ‌های تبدیل استفاده‌شده بر اساس نرخ‌های روزانه جفت‌های `FX_IDC` در روز قبل از کندل جاری محاسبه می‌شوند.

این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `currency.NONE` است، که در این صورت از ارز نمودار استفاده می‌شود.

مقادیر ممکن: یکی از ثابت‌ها در فضای `currency.*`، به‌عنوان مثال `currency.USD`.

---

## slippage (const int)

Slippage به میزان تغییرات قیمت در هنگام اجرای سفارش‌های بازار یا توقف `(stop orders)` اشاره دارد که به صورت تعداد تیک‌ها بیان می‌شود. این مقدار به قیمت اجرایی سفارش اضافه یا از آن کم می‌شود تا قیمت اجرایی کمتر از قیمت واقعی برای استراتژی باشد.

مثال:

- اگر `syminfo.mintick` برابر با `0.01` باشد و مقدار `slippage` برابر با `5` تنظیم شود، یک سفارش خرید بازار `(long market order)` با `5`` * 0.01 = 0.05` نقاط بالاتر از قیمت واقعی وارد خواهد شد.

این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `0` است

---

## commission_type (const string)

مشخص می‌کند که عدد وارد شده برای `commission_value` نمایانگر چه چیزی است:

- `strategy.commission.percent`: درصدی از حجم نقدی سفارش.
- `strategy.commission.cash_per_contract`: مقدار ارز به ازای هر قرارداد.
- `strategy.commission.cash_per_order`: مقدار ارز به ازای هر سفارش.

این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `strategy.commission.percent` است.

---

## commission_value (const int/float)

کمیسیون اعمال‌شده به سفارش‌های استراتژی بر حسب واحدهایی که با پارامتر `commission_type` مشخص شده است، تعیین می‌شود.

این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `0` است.

---

## process_orders_on_close (const bool)

زمانی که این گزینه روی `true` تنظیم شود، یک تلاش اضافی برای اجرای سفارش‌ها پس از بسته شدن یک کندل و تکمیل محاسبات استراتژی انجام می‌شود.

- اگر سفارش‌ها سفارش بازار `(market orders)` باشند، شبیه‌ساز کارگزار `(broker emulator)` آنها را قبل از باز شدن کندل بعدی اجرا می‌کند.
    اگر سفارش‌ها وابسته به قیمت `(price-dependent)` باشند، تنها زمانی پر می‌شوند که شرایط قیمت برآورده شوند.

این گزینه برای مواقعی مفید است که بخواهید موقعیت‌ها را در همان کندل فعلی ببندید.

این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `false` است.

---

## close_entries_rule (const string)

ترتیب بسته شدن معاملات را تعیین می‌کند. مقادیر ممکن عبارتند از:

- `"FIFO" (First-In, First-Out)`: در این حالت، اولین سفارش خروجی باید اولین سفارش ورودی را ببندد.

- `"ANY"`: در این حالت، سفارش‌ها بر اساس پارامتر `from_entry` در تابع `strategy.exit` بسته می‌شوند.

- `"FIFO`" تنها می‌تواند در معاملات سهام، فیوچرز و فارکس ایالات متحده (طبق قانون تطبیق NFA 2-43b) استفاده شود.

- `"ANY"` برای فارکس غیر ایالات متحده مجاز است.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `"FIFO"` است.

---

## margin_long (const int/float)

باید توسط وجه نقد یا وثیقه پوشش داده شود.

- باید یک عدد غیرمنفی باشد.
- منطق استفاده‌شده برای شبیه‌سازی margin call در مرکز راهنمایی توضیح داده شده است.

این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `0` است، که در این صورت استراتژی هیچ محدودیتی در اندازه موقعیت اعمال نمی‌کند

---

## margin_short (const int/float)

باید توسط وجه نقد یا وثیقه پوشش داده شود.

- باید یک عدد غیرمنفی باشد.
- منطق استفاده‌شده برای شبیه‌سازی `margin call` در مرکز راهنمایی توضیح داده شده است.

این تنظیم همچنین می‌تواند از طریق تب `"Settings/Properties"` در تنظیمات استراتژی تغییر داده شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `0` است، که در این صورت استراتژی هیچ محدودیتی در اندازه موقعیت اعمال نمی‌کند

---

## explicit_plot_zorder (const bool)

ترتیب رسم `plots،` `fills` و `hlines` اسکریپت را مشخص می‌کند.

- اگر مقدار `true` باشد، `plots` به ترتیبی که در کد اسکریپت آمده‌اند رسم می‌شوند، به طوری که هر `plot` جدید بالای `plot` قبلی کشیده می‌شود.
- این فقط برای توابع `plot،` `fill` و `hline` اعمال می‌شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `false` است.

---

## max_lines_count (const int)

تعداد آخرین خطوط رسم‌شده که نمایش داده می‌شوند را مشخص می‌کند.

مقادیر ممکن: `1` تا `500`.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `50` است.

---

## max_labels_count (const int)

تعداد آخرین برچسب‌های رسم‌شده که نمایش داده می‌شوند را مشخص می‌کند.

مقادیر ممکن: `1` تا `500`.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `50` است.

---

## max_boxes_count (const int)

تعداد آخرین جعبه‌های رسم‌شده که نمایش داده می‌شوند را مشخص می‌کند.

مقادیر ممکن: `1` تا `500`.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `50` است.

---

## calc_bars_count (const int)

مقدار محاسبات اولیه اسکریپت را به تعداد مشخصی از آخرین کندل‌ها محدود می‌کند.

- وقتی این مقدار مشخص شود، یک فیلد `"Calculated bars"` در بخش `"Calculation"` در تب `"Settings/Inputs"` اسکریپت اضافه می‌شود.
- این تنظیم اختیاری است و مقدار پیش‌فرض آن `0` است، که در این صورت اسکریپت بر روی تمام کندل‌های موجود اجرا می‌شود.

---

## risk_free_rate (const int/float)

نرخ بازده بدون ریسک `(risk-free rate of return)` تغییر سالانه درصدی در ارزش یک سرمایه‌گذاری با حداقل یا بدون ریسک است. این نرخ برای محاسبه نسبت‌های `Sharpe` و `Sortino` استفاده می‌شود.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `2` است.

---

## use_bar_magnifier (const bool)

زمانی که این گزینه روی `true` تنظیم شود، شبیه‌ساز کارگزار (`Broker Emulator`) از داده‌های تایم‌فریم پایین‌تر در طول آزمون تاریخی (`backtesting`) استفاده می‌کند تا نتایج واقعی‌تری به دست آورد.

این تنظیم اختیاری است و مقدار پیش‌فرض آن `false` است. تنها حساب‌های پریمیوم به این ویژگی دسترسی دارند.

---

## fill_orders_on_standard_ohlc (const bool)

زمانی که این گزینه روی `true` تنظیم شود، استراتژی‌هایی که روی نمودارهای `Heikin Ashi` اجرا می‌شوند، مجبور به پر کردن سفارش‌ها با استفاده از قیمت‌های واقعی OHLC (Open, High, Low, Close) می‌شوند تا نتایج واقعی‌تری به دست آید.

این تنظیم اختیاری است و مقدار پیش‌فرض آن `false` است.

---

## max_polylines_count (const int)

تعداد آخرین خطوط پلی‌لاین (`polyline`) رسم‌شده که نمایش داده می‌شوند را مشخص می‌کند.

مقادیر ممکن: `1` تا `100`.
تعداد نمایش داده شده تقریبی است و ممکن است بیشتر از تعداد مشخص شده باشد.

این آرگومان اختیاری است و مقدار پیش‌فرض آن `50` است.

---

## dynamic_requests (const bool)

مشخص می‌کند که آیا اسکریپت می‌تواند به طور پویا از توابع موجود در فضای نام request.*() استفاده کند یا خیر.

- درخواست‌های پویا (dynamic request.*() calls) در داخل دامنه‌های محلی ساختارهای شرطی (مثل if)، حلقه‌ها (مثل for) و توابع صادرشده مجاز هستند.
- علاوه بر این، چنین درخواست‌هایی امکان استفاده از آرگومان‌های `series` را برای بسیاری از پارامترهای خود دارند.

این تنظیم اختیاری است و مقدار پیش‌فرض آن `false` است. برای اطلاعات بیشتر، بخش `Dynamic requests` در دفترچه راهنمای کاربر را مشاهده کنید.

---

## behind_chart (const bool)

کنترل می‌کند که آیا `plots` و `drawings` اسکریپت در پنل اصلی نمودار پشت نمایش نمودار قرار بگیرند (اگر مقدار `true` باشد) یا در جلوی آن (اگر مقدار `false` باشد).

این تنظیم اختیاری است و مقدار پیش‌فرض آن `true` است.


---

## مثال:

```pine
/@version=6
strategy("My strategy", overlay=true, margin_long=100, margin_short=100)

longCondition = ta.crossover(ta.sma(close, 14), ta.sma(close, 28))
if (longCondition)
    strategy.entry("My Long Entry Id", strategy.long)

shortCondition = ta.crossunder(ta.sma(close, 14), ta.sma(close, 28))
if (shortCondition)
    strategy.entry("My Short Entry Id", strategy.short)

```

